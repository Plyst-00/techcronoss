<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>„ÉÜ„ÇØ„É≠„Éé„Çπ ÊúÄÂº∑TierË°®Ôºà„Ç®„Ç¢„ÉóÁâàÔºâ</title>
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@700;900&display=swap" rel="stylesheet">
<style>
/* ÂÖ®‰ΩìÁöÑ„Å™„É™„Çª„ÉÉ„ÉàÔºö„Åì„ÅÆ„Éñ„É≠„ÉÉ„ÇØÂÜÖ„Åß„ÅÆ„ÅøÊúâÂäπ */
.tier-swell-fix *,
.tier-swell-fix *::before,
.tier-swell-fix *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    border: 0;
    font-family: inherit;
    font-size: 100%;
    vertical-align: baseline;
}

.tier-swell-fix {
    display: block;
    max-width: 1000px;
    margin: 0 auto;
    padding: 16px;
    font-family: 'Zen Maru Gothic', sans-serif !important;
    font-weight: 700;
    color: #444;
    background: transparent !important;
    line-height: 1.5;
}

/* ÁîªÂÉè„ÅÆÊö¥Ëµ∞„ÇíÈò≤„Åê */
.tier-swell-fix img {
    max-width: none !important;
    height: auto !important;
    vertical-align: middle;
}

/* „Éú„Çø„É≥„ÉªÂÖ•Âäõ„ÅÆ„É™„Çª„ÉÉ„Éà */
.tier-swell-fix button,
.tier-swell-fix input {
    font-family: inherit !important;
    background: none;
    border: none;
    cursor: pointer;
    outline: none;
}

/* Ê§úÁ¥¢„Éª„Éï„Ç£„É´„Çø„Éº */
.tier-swell-fix .filter-container {
    margin-bottom: 20px;
    background: #fff;
    padding: 16px 20px;
    border-radius: 16px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.tier-swell-fix .search-row {
    margin-bottom: 16px;
}

.tier-swell-fix .search-input {
    width: 100% !important;
    padding: 12px 20px;
    border-radius: 12px;
    border: 2px solid #eee !important;
    background: #fff !important;
    font-family: inherit;
    font-weight: 700;
    font-size: 1em;
    outline: none;
    transition: 0.2s;
}

.tier-swell-fix .search-input:focus {
    border-color: #ff76a1 !important;
    box-shadow: 0 0 8px rgba(255,118,161,0.2);
}

.tier-swell-fix .filter-row {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 16px;
    align-items: flex-start;
}

.tier-swell-fix .filter-label {
    font-size: 0.82em;
    font-weight: 900;
    color: #888;
    margin-bottom: 8px;
    background: transparent !important;
    border: none !important;
    padding: 0 !important;
}

.tier-swell-fix .filter-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.tier-swell-fix .filter-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 14px;
    border: 2px solid #ddd !important;
    background: #fff !important;
    border-radius: 25px !important;
    font-size: 0.9em !important;
    font-weight: 700 !important;
    color: #666 !important;
    transition: 0.2s;
    line-height: 1.2 !important;
}

.tier-swell-fix .filter-btn.active {
    background: #ff76a1 !important;
    color: #fff !important;
    border-color: #ff76a1 !important;
}

.tier-swell-fix .btn-element-wrap {
    position: relative;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.tier-swell-fix .btn-element-wrap .element-diamond-bg {
    position: absolute;
    width: 85%;
    height: 85%;
    border-radius: 5px;
    transform: rotate(45deg);
}

.tier-swell-fix .element-icon {
    position: relative;
    width: 70%;
    height: 70%;
    z-index: 6;
    object-fit: contain;
    filter: brightness(0) invert(1);
}

/* „Ç´„Éº„Éâ„Éï„ÉÉ„Çø„ÉºÔºàÂè≥‰∏ã„Ç¢„Ç§„Ç≥„É≥„Ç®„É™„Ç¢Ôºâ */
.tier-swell-fix .tier-img-footer {
    position: absolute;
    bottom: 2px;
    right: 2px;
    display: flex;
    gap: 2px;
    z-index: 120;
    pointer-events: none;
}

/* NEW„Ç¢„Ç§„Ç≥„É≥ */
.tier-swell-fix .tier-new {
    background: #ff4d6d;
    color: white;
    font-size: 11px;
    font-weight: 900;
    padding: 2px 6px;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    letter-spacing: 0.5px;
    line-height: 1.2;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;
}

/* ‰∏ä‰∏ã„Ç¢„Ç§„Ç≥„É≥ */
.tier-swell-fix .tier-updown {
    width: 24px;
    height: 24px;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    font-weight: bold;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.tier-swell-fix .tier-updown[data-updown="‚Üë"] { color: #f00; }
.tier-swell-fix .tier-updown[data-updown="‚Üì"] { color: #00f; }

/* „Ç´„Éº„ÉâÊú¨‰Ωì */
.tier-swell-fix .card-shadow-wrapper {
    position: relative;
    width: 120px !important;
    filter: drop-shadow(0 6px 0 rgba(0,0,0,0.4));
    opacity: 0;
    transition: transform 0.2s, opacity 0.5s;
    cursor: pointer;
}

.tier-swell-fix .card-shadow-wrapper.reveal {
    opacity: 1;
}

.tier-swell-fix .card-shadow-wrapper:hover {
    transform: scale(1.05);
    z-index: 1000;
}

.tier-swell-fix .tier-row {
    display: flex;
    flex-direction: column;
    margin-bottom: 60px;
}

.tier-swell-fix .tier-label {
    position: -webkit-sticky;
    position: sticky;
    top: 0;
    width: 100%;
    font-weight: 900;
    font-size: 1.4em;
    background: #555;
    color: #fff;
    border-radius: 8px;
    margin-bottom: 12px;
    padding: 6px 16px;
    border-left: 8px solid #333;
    z-index: 500;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.tier-swell-fix .tier-cards {
    display: flex;
    flex-wrap: wrap;
    gap: 48px 20px;
    justify-content: flex-start;
    padding: 60px 10px 20px;
}

.tier-swell-fix .tier-stars-top {
    position: absolute;
    top: -18px;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: center;
    z-index: 70;
    pointer-events: none;
}

.tier-swell-fix .tier-stars-top svg {
    width: 28px;
    height: 28px;
    margin: 0 -4px;
}

.tier-swell-fix .tier-card {
    position: relative;
    width: 100%;
    background: #fff;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    overflow: visible;
    z-index: 10;
}

.tier-swell-fix .tier-img-wrap {
    position: relative;
    width: 100%;
    height: 120px;
    z-index: 5;
    border-radius: 16px 16px 0 0;
    overflow: hidden;
}

.tier-swell-fix .tier-img-wrap img.main-char {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
    display: block;
}

.tier-swell-fix .tier-type-line-overlay {
    display: flex;
    gap: 2px;
    position: absolute;
    top: 4px;
    width: 100%;
    z-index: 60;
}

.tier-swell-fix .tier-type,
.tier-swell-fix .tier-line {
    color: #fff;
    font-size: 0.75em;
    font-weight: 900;
    border-radius: 30px;
    padding: 1px 0;
    width: 58px !important;
    text-align: center;
    display: inline-block !important;
    white-space: nowrap;
}

.tier-swell-fix .tier-element-wrap {
    position: absolute;
    bottom: 2px;
    left: 2px;
    width: 42px;
    height: 42px;
    z-index: 110;
    display: flex;
    align-items: center;
    justify-content: center;
}

.tier-swell-fix .tier-element-wrap .element-diamond-bg {
    position: absolute;
    width: 75%;
    height: 75%;
    border-radius: 7px;
    transform: rotate(45deg);
    border: 2px solid #fff;
}

.tier-swell-fix .tier-charname {
    width: 100%;
    background: #f2f2f2;
    color: #5b5b5b;
    font-size: 0.95em;
    font-weight: 900;
    text-align: center;
    padding: 5px 1px;
    line-height: 1.1;
}

.tier-swell-fix .tier-category {
    width: 100%;
    color: #fff;
    font-size: 1.15em;
    font-weight: 900;
    text-align: center;
    padding: 1px 0;
    border-radius: 0 0 16px 16px;
}

/* ---------- „Çπ„Éû„ÉõÊúÄÈÅ©Âåñ ---------- */
@media (max-width: 600px) {
    .tier-swell-fix {
        padding: 8px;
    }
    .tier-swell-fix .filter-row {
        flex-direction: column;
        gap: 16px;
    }
    .tier-swell-fix .filter-group {
        width: 100%;
    }
    .tier-swell-fix .filter-buttons {
        gap: 6px;
    }
    .tier-swell-fix .filter-btn {
        padding: 8px 12px;
        font-size: 0.85em !important;
    }
    .tier-swell-fix .btn-element-wrap {
        width: 20px;
        height: 20px;
    }

    .tier-swell-fix .tier-cards {
        gap: 56px 24px !important;
        justify-content: center !important;
        padding: 60px 0 20px !important;
    }
    .tier-swell-fix .card-shadow-wrapper {
        width: 96px !important;
    }
    .tier-swell-fix .tier-img-wrap {
        height: 96px;
    }
    .tier-swell-fix .tier-type-line-overlay {
        top: -12px !important;
    }
    .tier-swell-fix .tier-type,
    .tier-swell-fix .tier-line {
        font-size: 0.65em;
        width: auto !important;
        min-width: 42px;
        padding: 1px 6px;
    }
    .tier-swell-fix .tier-stars-top {
        top: -32px;
    }
    .tier-swell-fix .tier-stars-top svg {
        width: 22px;
        height: 22px;
    }
    .tier-swell-fix .tier-element-wrap {
        width: 21px;
        height: 21px;
        bottom: 1px;
        left: 1px;
    }
    .tier-swell-fix .tier-element-wrap .element-diamond-bg {
        border-radius: 4px;
        border-width: 1.5px;
    }
    .tier-swell-fix .tier-charname {
        font-size: 0.8em;
        padding: 3px 1px;
    }
    .tier-swell-fix .tier-category {
        font-size: 0.95em;
        padding: 2px 0;
    }
    .tier-swell-fix .tier-label {
        font-size: 1.2em;
        padding: 8px 12px;
    }

    /* „É¢„Éº„ÉÄ„É´„ÅÆ„Çπ„Éû„ÉõÊúÄÈÅ©Âåñ */
    .tier-swell-fix .modal-content {
        width: 95%;
        padding: 16px;
    }
    .tier-swell-fix .modal-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    .tier-swell-fix .modal-header img {
        width: 60px;
        height: 60px;
    }

    .tier-swell-fix .tier-updown {
        width: 20px;
        height: 20px;
        font-size: 14px;
    }
    .tier-swell-fix .tier-new {
        font-size: 9px;
        padding: 1px 4px;
    }
}

/* „É¢„Éº„ÉÄ„É´Âü∫Êú¨„Çπ„Çø„Ç§„É´ */
.tier-swell-fix #skill-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.75);
    z-index: 9999 !important;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(5px);
}

.tier-swell-fix .modal-content {
    background: #fdfaf5;
    width: 92%;
    max-width: 550px;
    border-radius: 28px;
    padding: 24px;
    position: relative;
    max-height: 85vh;
    overflow-y: auto;
}

.tier-swell-fix .modal-close {
    position: absolute;
    top: 16px;
    right: 20px;
    font-size: 32px;
    cursor: pointer;
    color: #aaa;
}

.tier-swell-fix .modal-header {
    display: flex;
    align-items: center;
    gap: 18px;
    margin-bottom: 20px;
    background: #fff;
    padding: 15px;
    border-radius: 20px;
}

.tier-swell-fix .modal-header img {
    width: 70px;
    height: 70px;
    border-radius: 15px;
    object-fit: cover;
    border: 3px solid #f0f0f0;
}

.tier-swell-fix .skill-box {
    margin-bottom: 16px;
    background: #fff;
    border-radius: 18px;
    overflow: hidden;
    border: 1px solid #eee;
    box-shadow: 0 2px 8px rgba(0,0,0,0.03);
}

.tier-swell-fix .skill-title-row {
    background: #f8f9fa;
    padding: 10px 16px;
    border-bottom: 2px solid #f0f0f0;
    display: flex;
    align-items: center;
}

.tier-swell-fix .skill-label {
    font-size: 0.75em;
    background: #666;
    color: #fff;
    padding: 2px 10px;
    border-radius: 6px;
    margin-right: 10px;
    white-space: nowrap;
}

.tier-swell-fix .skill-name {
    font-weight: 900;
    color: #333;
    font-size: 1.05em;
}

.tier-swell-fix .skill-body {
    padding: 14px 16px;
    font-size: 0.92em;
    line-height: 1.6;
    color: #555;
}

.tier-swell-fix .skill-footer {
    margin-top: 10px;
    padding-top: 8px;
    border-top: 1px dashed #eee;
    display: flex;
    gap: 15px;
    font-size: 0.85em;
    color: #ff5606;
    font-weight: 900;
}
</style>
</head>
<body>

<svg width="0" height="0" style="position:absolute;">
  <defs>
    <linearGradient id="global-gold-gradient" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#FFD700"/><stop offset="50%" stop-color="#FFFACD"/><stop offset="100%" stop-color="#FFA500"/>
    </linearGradient>
    <filter id="star-shadow" x="-50%" y="-50%" width="200%" height="200%">
      <feOffset dx="0.3" dy="0.3" />
      <feGaussianBlur stdDeviation="0.4" /><feComponentTransfer><feFuncA type="linear" slope="0.7"/></feComponentTransfer>
      <feBlend in="SourceGraphic" mode="normal" />
    </filter>
  </defs>
</svg>

<div class="tier-swell-fix">
    <h2 class="tier-page-title">„ÉÜ„ÇØ„É≠„Éé„Çπ ÊúÄÂº∑TierË°®Ôºà„Ç®„Ç¢„ÉóÁâàÔºâ</h2>
    <div id="skill-modal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <div class="filter-container">
        <div class="search-row">
            <input type="text" id="search-box" class="search-input" placeholder="„Ç≠„É£„É©Âêç„Éª„Çπ„Ç≠„É´Ë©≥Á¥∞„Å™„Å©„ÅßÊ§úÁ¥¢" oninput="applyFilter()">
        </div>

        <div class="filter-row">
            <div class="filter-group">
                <div class="filter-label">‚úß „Ç®„É¨„É°„É≥„Éà ‚úß</div>
                <div class="filter-buttons" id="filter-element"></div>
            </div>
            <div class="filter-group">
                <div class="filter-label">‚úß „Ç´„ÉÜ„Ç¥„É™„Éº ‚úß</div>
                <div class="filter-buttons">
                    <button class="filter-btn" data-type="category" data-value="BATTLE" onclick="toggleFilter(this)">BATTLE</button>
                    <button class="filter-btn" data-type="category" data-value="ASSIST" onclick="toggleFilter(this)">ASSIST</button>
                </div>
            </div>
        </div>
        <div class="filter-row">
            <div class="filter-group">
                <div class="filter-label">‚úß „Çø„Ç§„Éó ‚úß</div>
                <div class="filter-buttons" id="filter-type"></div>
            </div>
            <div class="filter-group">
                <div class="filter-label">‚úß „É©„Ç§„É≥ ‚úß</div>
                <div class="filter-buttons">
                    <button class="filter-btn" data-type="line" data-value="ÂâçË°õ" onclick="toggleFilter(this)">ÂâçË°õ</button>
                    <button class="filter-btn" data-type="line" data-value="ÂæåË°õ" onclick="toggleFilter(this)">ÂæåË°õ</button>
                    <button class="filter-btn" data-type="line" data-value="Ââç/Âæå" onclick="toggleFilter(this)">Ââç/Âæå</button>
                </div>
            </div>
        </div>
    </div>
    <div id="tier-table"></div>
    <p class="tier-note footer-note">¬© since 1998 DMM All Rights Reserved.</p>
    <p class="tier-note footer-note">¬© 2026 EXNOA LLC/„ÉÜ„ÇØ„É≠„Çπ</p>
</div>

<script>
// „Éá„Éº„ÇøÂèñÂæó„Å®ÊèèÁîªÔºàNEW„Ç¢„Ç§„Ç≥„É≥ÂØæÂøúÔºâ
let allCards = [];
const CAT_COLORS = {"BATTLE": "#fe1b76", "ASSIST": "#0072ff"};
const TYPE_COLORS = {"„Éí„Éº„É´": "#3cbe00", "„Éë„ÉØ„Éï„É´": "#ff205d", "„Çµ„Éù„Éº„Éà": "#ff5606", "„Éñ„É¨„Ç§„ÇØ": "#2372ff", "„Éà„É™„ÉÉ„ÇØ": "#922efe"};
const LINE_COLORS = {"ÂâçË°õ": "#30a6fa", "ÂæåË°õ": "#fa19bd", "Ââç/Âæå": "linear-gradient(to right, #ef25c9, #2597fd)"};
let currentFilters = { element: null, category: null, type: null, line: null };

function buildFilterButtons(cards) {
    const elements = [...new Set(cards.map(c => c.element))];
    const types = [...new Set(cards.map(c => c.type))];
    const elementContainer = document.getElementById('filter-element');
    const typeContainer = document.getElementById('filter-type');
    elementContainer.innerHTML = '';
    typeContainer.innerHTML = '';
    elements.forEach(e => {
        const btn = document.createElement('button');
        btn.className = 'filter-btn';
        btn.setAttribute('data-type', 'element');
        btn.setAttribute('data-value', e);
        btn.onclick = function() { toggleFilter(this); };
        const cardSample = cards.find(c => c.element === e);
        const color = cardSample ? cardSample.element_color : '#888';
        const imgUrl = cardSample ? cardSample.element_img : '';
        btn.innerHTML = `<div class="btn-element-wrap"><div class="element-diamond-bg" style="background:${color};"></div><img src="${imgUrl}" class="element-icon" alt="${e}"></div>${e}`;
        elementContainer.appendChild(btn);
    });
    types.forEach(t => {
        const btn = document.createElement('button');
        btn.className = 'filter-btn';
        btn.setAttribute('data-type', 'type');
        btn.setAttribute('data-value', t);
        btn.onclick = function() { toggleFilter(this); };
        btn.textContent = t;
        typeContainer.appendChild(btn);
    });
}

function renderCards(cards) {
    const container = document.getElementById('tier-table');
    container.innerHTML = '';
    const tiers = [...new Set(cards.map(c => c.tier))].sort((a, b) => a - b);
    tiers.forEach(tier => {
        const tierCards = cards.filter(c => c.tier === tier);
        const rowDiv = document.createElement('div');
        rowDiv.className = 'tier-row';
        rowDiv.dataset.tier = tier;
        rowDiv.innerHTML = `<div class="tier-label">Tier ${tier}</div><div class="tier-cards"></div>`;
        const cardsDiv = rowDiv.querySelector('.tier-cards');
        tierCards.forEach(card => {
            const starSvg = '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="filter:url(#star-shadow);"><polygon points="12,2 15,9 22,9 17,14 18,21 12,17 6,21 7,14 2,9 9,9" fill="url(#global-gold-gradient)" stroke="#7a6700" stroke-width="1.2"/></svg>';
            const stars = Array(card.rarity).fill(starSvg).join('');
            const lineHtml = !card.is_assist ? `<span class="tier-line" style="background:${LINE_COLORS[card.line] || '#888'};">${card.line}</span>` : '';
            
            // NEW„Ç¢„Ç§„Ç≥„É≥
            const newHtml = card.is_new ? '<span class="tier-new">NEW</span>' : '';
            // ‰∏ä‰∏ã„Ç¢„Ç§„Ç≥„É≥
            const updownHtml = (card.updown === '‚Üë' || card.updown === '‚Üì') ? `<span class="tier-updown" data-updown="${card.updown}">${card.updown === '‚Üë' ? '‚ñ≤' : '‚ñº'}</span>` : '';
            
            // „Éï„ÉÉ„Çø„Éº„Ç≥„É≥„ÉÜ„ÉäÔºà„Ç¢„Ç§„Ç≥„É≥„ÇíÊ®™‰∏¶„Å≥Ôºâ
            const footerHtml = (newHtml || updownHtml) ? `<div class="tier-img-footer">${newHtml}${updownHtml}</div>` : '';

            const cardDiv = document.createElement('div');
            cardDiv.className = 'card-shadow-wrapper';
            cardDiv.dataset.id = card.id;
            cardDiv.dataset.element = card.element;
            cardDiv.dataset.type = card.type;
            cardDiv.dataset.line = card.line;
            cardDiv.dataset.category = card.category;
            cardDiv.dataset.search = card.search_all;
            cardDiv.setAttribute('onclick', `openModal('${card.id}')`);
            cardDiv.innerHTML = `
                <div class="tier-stars-top">${stars}</div>
                <div class="tier-card">
                    <div class="tier-type-line-overlay" style="${card.overlay_style}">
                        <span class="tier-type" style="background:${TYPE_COLORS[card.type] || '#888'};">${card.type}</span>
                        ${lineHtml}
                    </div>
                    <div class="tier-img-wrap">
                        <img src="${card.img_url}" class="main-char" loading="lazy">
                        <div class="tier-element-wrap">
                            <div class="element-diamond-bg" style="background:${card.element_color};"></div>
                            <img src="${card.element_img}" class="element-icon">
                        </div>
                        ${footerHtml}
                    </div>
                    <div class="tier-charname">${card.name}</div>
                    <div class="tier-category" style="background:${CAT_COLORS[card.category] || '#222'};">${card.category}</div>
                </div>
            `;
            cardsDiv.appendChild(cardDiv);
        });
        container.appendChild(rowDiv);
    });
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('reveal'); observer.unobserve(entry.target); } });
    }, { threshold: 0.1 });
    document.querySelectorAll('.card-shadow-wrapper').forEach(card => observer.observe(card));
}

function openModal(cardId) {
    const card = allCards.find(c => c.id === cardId);
    if (!card) return;
    const body = document.getElementById('modal-body');
    let skillHtml = `<div class="modal-header"><img src="${card.img_url}"><div><div style="font-size:1.3em; font-weight:900; color:#333;">${card.name} <span style="font-size:0.7em; color:#888; margin-left:4px;">[${card.nickname || ''}]</span></div><div style="font-size:0.8em; color:#999; letter-spacing:1px;">CHARACTER DETAILS</div></div></div>`;
    card.skills.forEach(s => {
        if (!s.name || s.name === "-") return;
        const formattedDesc = parseColorTags(s.desc);
        let ctDisplay = (s.ct && s.ct !== "-") ? (isNaN(parseFloat(s.ct)) ? s.ct : parseFloat(s.ct).toFixed(1)) : "";
        skillHtml += `<div class="skill-box"><div class="skill-title-row"><span class="skill-label" style="background:${getLabelColor(s.label)}">${s.label}</span><span class="skill-name">${s.name}</span></div><div class="skill-body"><div>${formattedDesc}</div>${(ctDisplay || s.use) ? `<div class="skill-footer">${ctDisplay ? `<span>‚è± „ÇØ„Éº„É´„Çø„Ç§„É†: ${ctDisplay}</span>` : ''}${(s.use && s.use !== "-") ? `<span>üîÑ ‰ΩøÁî®ÂõûÊï∞: ${s.use}</span>` : ''}</div>` : ''}</div></div>`;
    });
    body.innerHTML = skillHtml;
    document.getElementById('skill-modal').style.display = 'flex';
}

function parseColorTags(text) {
    if (!text) return "";
    let parsed = text.replace(/\\n/g, '<br>').replace(/\n/g, '<br>');
    parsed = parsed.replace(/<color=(#[0-9a-fA-F]{6})>/g, '<span style="color:$1">');
    parsed = parsed.replace(/<\/color>/g, '</span>');
    return parsed;
}

function getLabelColor(label) {
    if (label === '„Çπ„Éö„Ç∑„É£„É´') return '#ff205d';
    if (label === '„Ç¢„Ç∑„Çπ„Éà') return '#0072ff';
    if (label === '„Éë„ÉÉ„Ç∑„Éñ') return '#666';
    return '#ff880a';
}

function closeModal() { document.getElementById('skill-modal').style.display = 'none'; }

function toggleFilter(btn) {
    const type = btn.getAttribute('data-type');
    const value = btn.getAttribute('data-value');
    currentFilters[type] = (currentFilters[type] === value) ? null : value;
    document.querySelectorAll('.filter-btn').forEach(b => {
        b.classList.toggle('active', currentFilters[b.getAttribute('data-type')] === b.getAttribute('data-value'));
    });
    applyFilter();
}

function applyFilter() {
    const searchQuery = document.getElementById('search-box').value.toLowerCase();
    document.querySelectorAll('.card-shadow-wrapper').forEach(card => {
        const mEl = !currentFilters.element || card.dataset.element === currentFilters.element;
        const mCa = !currentFilters.category || card.dataset.category === currentFilters.category;
        const mTy = !currentFilters.type || card.dataset.type === currentFilters.type;
        const mLi = !currentFilters.line || card.dataset.line === currentFilters.line;
        const searchTarget = card.dataset.search.toLowerCase();
        const mSearch = !searchQuery || searchTarget.includes(searchQuery);
        card.style.display = (mEl && mCa && mTy && mLi && mSearch) ? '' : 'none';
    });
    document.querySelectorAll('.tier-row').forEach(row => {
        const hasVisibleCard = Array.from(row.querySelectorAll('.card-shadow-wrapper')).some(c => c.style.display !== 'none');
        row.style.display = hasVisibleCard ? '' : 'none';
    });
}

// ÂàùÊúüÂåñÔºöJSONË™≠„ÅøËæº„ÅøÔºàAPI„Ç®„É≥„Éâ„Éù„Ç§„É≥„ÉàÔºâ
fetch('https://meister.knowhow.jp/wp-json/custom/v1/tier-cards')
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        allCards = data;
        buildFilterButtons(allCards);
        renderCards(allCards);
    })
    .catch(err => {
        console.error('APIË™≠„ÅøËæº„Åø„Ç®„É©„ÉºË©≥Á¥∞:', err);
        document.getElementById('tier-table').innerHTML = '<p style="color:red;">„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ</p>';
    });
</script>
</body>
</html>
